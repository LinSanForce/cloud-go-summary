# Tag Retention

  1.9 版提供了一项增强功能，用于更好地管理镜像生命周期并优化存储分配，称为Tag Retention。
  
  Harbor 的存储中可能会迅速累积起大量镜像的文件，特别是在 Harbor 与 CI 系统挂钩在一起以自动生成中间或者内部版本时，许多 tag 会在一定时间之后或被下一个内部版本取代后过时。
  
  此功能可以定义镜像tag保留策略，以留存具有特定匹配规则的镜像，同时删除其他 tag 及其关联的 Blob。参考的本质信息是镜像tag包含的环境和镜像使用情况的大量元数据信息。
  
  
  
## Tag Retention配置方法
   首先选定“项目”，保留规则的制定是以 “仓库” 为基本单位。
   一共提供了 “仓库匹配”，“镜像推送或者下载天数”，“Tags”进行组合条件匹配。以下是按例讲解
   
1.仓库匹配。
  
   可以选择 “匹配”或者“排除”， 填写具体仓库名称就应用到具体仓库。 **代表应用到所有仓库。
   
   以“daizhang”项目为例， “task-*” 将匹配“daizhang/task-adaptor”，“daizhang/task-service”，“daizhang/task-web”。
   

2.Tag匹配。
  
   结合上述仓库可以更加精确定位到某个Tag的镜像，采用与上述一样的正则方法。
   

3.“镜像推送或者下载天数”。

   可以“保留最近天数”，也可以“保留最近几个”，当这两个规则同时存在，则两者是Or的关系，满足其中任一规则的镜像都会被保留。
   
   

## 注意事项
1.如果项目设置了资源限制，那么保留规则也无法绕过此限制。

2.在真正执行之前建议通过dry run验证，再正式使用。